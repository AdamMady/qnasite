<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>music archive</title>
  <style>
    /* General body styling */
    body {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      font-family: Helvetica, Arial, sans-serif;
      background-color: #1e1e1e;
      color: #e0e0e0;
      text-align: center;
      padding: 20px;
      margin: 0;
    }
    .container {
      max-width: 400px;
      width: 100%;
    }
    .qna {
      border: 1px solid #666565;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      background-color: #2b2b2b;
      word-break: break-word;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .song-cover {
      max-width: 200px;
      height: auto;
      border-radius: 8px;
      border: 1px solid #666565;
      margin-bottom: 10px;
    }
    .song-title {
      font-weight: bold;
      font-size: 1.2em;
      margin: 5px 0;
      text-transform: lowercase;
    }
    .song-date {
      color: pink;
      margin-bottom: 10px;
    }
    .audio-download-container {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      position: relative;
    }
    .audio-player {
      flex: 1;
      max-width: 300px;
    }
    .audio-player::-webkit-media-controls-panel {
      background-color: #9e9e9e;
    }
    .download-button {
      background: none;
      border: none;
      color: lightgray;
      font-size: 1.5em;
      cursor: pointer;
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      padding: 5px;
      transition: color 0.3s;
    }
    .download-button:hover {
      color: #fff;
    }
    .background-note {
      font-size: 0.85em;
      color: #ccc;
      margin-top: 30px;
    }
    .back-button {
      display: inline-block;
      padding: 10px 20px;
      background-color: #474747;
      color: lightgray;
      text-decoration: none;
      border-radius: 5px;
      font-weight: bold;
      transition: background-color 0.3s;
      margin-bottom: 20px;
    }
    .back-button:hover {
      background-color: #5a6268;
    }
    @media (max-width: 600px) {
      .qna {
        padding: 10px;
      }
      .song-title {
        font-size: 1em;
      }
      .audio-download-container {
        flex-direction: column;
        align-items: stretch;
      }
      .download-button {
        position: static;
        transform: none;
        margin-top: 10px;
        align-self: center;
      }
    }
    .custom-audio::-webkit-media-controls-panel {
      background-color: #9e9e9e;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Back to inbox link -->
    <a href="/qnasite/" class="back-button">back to inbox</a>
    <h1>music archive</h1>
    <!-- Placeholder for songs -->
    <div class="songs-list"></div>
    <div class="background-note">
      <p>tried to export them all in the highest quality possible</p>
    </div>
  </div>

  <script>
    // Your song data
    const songs = [
      { title: "happy new year to", date: "january 1st 2025" },
      { title: "the sun is leaking", date: "december 18th 2024" },
      { title: "kill people with rocks", date: "december 16th 2024" },
      { title: "what the fuck", date: "december 16th 2024" },
      { title: "love has got to be everything", date: "november 26th 2024" },
      { title: "take you away", date: "november 23rd 2024" },
      { title: "yes", date: "november 13rd 2024" },
      { title: "time", date: "november 12th 2024" },
      { title: "i wanna be with you", date: "november 8th 2024" },
      { title: "good night", date: "november 8th 2024" }
    ];

    // Convert 'december 16th 2024' -> usable Date object
    const parseDate = str =>
      new Date(Date.parse(str.replace(/(\d+)(st|nd|rd|th)/, '$1')));

    // Sort newest first
    songs.sort((a, b) => parseDate(b.date) - parseDate(a.date));

    // Base URLs
    const baseMusicURL = "https://adammady.github.io/qnasite/musik/";
    const baseCoverURL = "https://adammady.github.io/qnasite/cover/";

    const songsList = document.querySelector(".songs-list");

    // Build song HTML
    const html = songs
      .map(song => {
        const encoded = encodeURIComponent(song.title.toLowerCase());
        return `
        <div class="qna">
          <img
            class="song-cover"
            src="${baseCoverURL}${encoded}.png"
            alt="cover of ${song.title}"
            onerror="this.src='https://via.placeholder.com/200?text=No+Cover';"
          />
          <p class="song-title">${song.title.toLowerCase()}</p>
          <p class="song-date">${song.date.toLowerCase()}</p>
          <div class="audio-download-container">
            <audio
              class="audio-player custom-audio"
              controls
              controlsList="nodownload noplaybackrate"
              onerror="this.outerHTML='<p style=color:red>Audio not available</p>'"
            >
              <source src="${baseMusicURL}${encoded}.WAV" type="audio/wav" />
            </audio>
            <button
              class="download-button"
              data-file="${baseMusicURL}${encoded}.WAV"
              data-title="${song.title}.WAV"
              aria-label="Download ${song.title}"
            >
              â­³
            </button>
          </div>
        </div>
        `;
      })
      .join("");

    // Insert all songs into DOM
    songsList.innerHTML = html;

    // Only one audio plays at a time
    let currentAudio = null;
    document.querySelectorAll(".audio-player").forEach(audio => {
      audio.addEventListener("play", () => {
        if (currentAudio && currentAudio !== audio) currentAudio.pause();
        currentAudio = audio;
      });
    });

    // Handle downloads
    document.querySelectorAll(".download-button").forEach(btn => {
      btn.addEventListener("click", async e => {
        e.preventDefault();
        const fileUrl = btn.dataset.file;
        const fileName = btn.dataset.title;
        try {
          const response = await fetch(fileUrl, { mode: "cors" });
          if (!response.ok) throw new Error("Network response was not ok");
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);

          // Create a temporary link
          const a = document.createElement("a");
          a.style.display = "none";
          a.href = url;
          a.download = fileName;
          document.body.appendChild(a);
          a.click();

          // Cleanup
          window.URL.revokeObjectURL(url);
          document.body.removeChild(a);
        } catch (err) {
          alert("Failed to download file.");
          console.error("Download error:", err);
        }
      });
    });
  </script>
</body>
</html>
